<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReVive Assessoria - Prevenção Contra Golpes</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilo customizado para usar a fonte Inter */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Efeito de hover sutil nos cards */
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        /* Animação do spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Cabeçalho -->
    <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg">
        <div class="container mx-auto px-6 py-12 text-center">
            <h1 class="text-4xl md:text-5xl font-bold mb-2">ReVive Assessoria</h1>
            <p class="text-lg md:text-xl text-indigo-200">Prevenção e Suporte Contra Golpes Digitais.</p>
        </div>
    </header>

    <!-- Conteúdo Principal com os Módulos -->
    <main class="container mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">

            <!-- 1. Assistente Conversacional Pós-Golpe -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">Sofri um golpe, e agora?</h2>
                <p class="text-gray-600 mb-4">Se você foi vítima de uma fraude, nosso assistente virtual irá te guiar com um passo a passo personalizado para agir rápido.</p>
                <button id="start-assistant-button" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Iniciar Assistente
                </button>
                <div id="assistant-placeholder" class="mt-4 text-center"></div>
            </div>

            <!-- 2. Simulador de Risco com IA (Funcionalidade com Gemini) -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">Simulador de Risco</h2>
                <p class="text-gray-600 mb-4">Recebeu uma mensagem suspeita? Cole o texto aqui e nossa IA irá analisar os riscos para você.</p>
                <textarea id="message-input" class="w-full h-24 p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Cole o e-mail, SMS ou mensagem de WhatsApp aqui..."></textarea>
                <button id="analyze-button" class="w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                    <span>✨</span>
                    <span>Analisar Mensagem</span>
                </button>
                <div id="analysis-result" class="mt-4"></div>
            </div>

            <!-- 3. Detector de Golpes Visuais -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">Detector Visual de Golpes</h2>
                <p class="text-gray-600 mb-4">Envie um print de um boleto, QR Code ou comprovante suspeito. Nossa IA verificará se há sinais de fraude.</p>
                <label for="file-upload" id="file-upload-label" class="cursor-pointer w-full inline-block bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-4 rounded-lg text-center transition-colors">
                    Selecionar Imagem
                </label>
                <input id="file-upload" type="file" class="hidden" accept="image/*" />
                <div id="image-preview-container" class="mt-4 hidden">
                    <img id="image-preview" src="#" alt="Pré-visualização da imagem" class="max-w-full h-auto rounded-lg mx-auto"/>
                </div>
                <div id="visual-analysis-result" class="mt-4"></div>
            </div>

            <!-- 4. Linha do Tempo Interativa (Atualizada) -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">Linha do Tempo de Recuperação</h2>
                <p class="text-gray-600 mb-4">Veja como o tempo de reação é crucial. Arraste a barra para entender suas chances de recuperar o dinheiro.</p>
                <input id="timeline-slider" type="range" min="1" max="48" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                <div class="flex justify-between text-xs text-gray-500 mt-1">
                    <span>1 hora</span>
                    <span>2 dias (48h)</span>
                </div>
                <div class="text-center mt-4 space-y-1">
                    <p class="font-semibold text-gray-700">Tempo decorrido: <span id="tempo-decorrido-valor" class="text-blue-700 font-bold">1 hora</span></p>
                    <p class="font-semibold text-lg">Chance de Recuperação: <span id="chance-valor" class="text-blue-700 font-bold">80%</span></p>
                </div>
            </div>

            <!-- 5. FAQ Inteligente -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">FAQ Inteligente</h2>
                <p class="text-gray-600 mb-4">Tem alguma dúvida? Pergunte diretamente para nossa IA e obtenha respostas na hora.</p>
                <input id="faq-input" type="text" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ex: Preciso fazer B.O.?">
                 <button id="faq-button" class="w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Perguntar
                </button>
                <div id="faq-result" class="mt-4"></div>
            </div>
            
            <!-- 6. Gerador de Infográfico Personalizado -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">Infográfico Personalizado</h2>
                <p class="text-gray-600 mb-4">Responda um questionário rápido e receba um guia de prevenção focado no seu perfil e nos seus hábitos.</p>
                <button id="generate-guide-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                    Gerar Meu Guia
                </button>
                <div id="guide-placeholder" class="mt-4 text-center"></div>
            </div>

            <!-- 7. Formulário de Relato de Novos Golpes -->
            <div class="bg-white p-6 rounded-xl shadow-md transition-all duration-300 feature-card md:col-span-2 xl:col-span-1">
                <h2 class="text-2xl font-bold text-blue-600 mb-3">Relate um Novo Golpe</h2>
                <p class="text-gray-600 mb-4">Ajude a comunidade! Descreva um golpe que você identificou para mantermos nossa base de dados atualizada.</p>
                <form id="report-form" class="space-y-3">
                    <input id="report-type" type="text" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Tipo de golpe" required>
                    <textarea id="report-description" class="w-full h-20 p-2 border border-gray-300 rounded-lg" placeholder="Descreva o golpe..." required></textarea>
                    <button type="submit" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                        Enviar Relato
                    </button>
                </form>
                <div id="report-result" class="mt-4"></div>
            </div>

        </div>
    </main>

    <!-- Rodapé -->
    <footer class="text-center py-8">
        <p class="text-gray-500">Projeto de código aberto. Feito para a comunidade.</p>
    </footer>

    <!-- JavaScript com a lógica da API Gemini -->
    <script>
        // --- Chave de API ---
        const GEMINI_API_KEY = "AIzaSyDBHEuxhSzc9vj3ZukQq17X25d9Ucw3XpE";

        // --- Seletores de Elementos ---
        const analyzeButton = document.getElementById('analyze-button');
        const messageInput = document.getElementById('message-input');
        const analysisResult = document.getElementById('analysis-result');
        const fileUploadInput = document.getElementById('file-upload');
        const visualAnalysisResult = document.getElementById('visual-analysis-result');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const fileUploadLabel = document.getElementById('file-upload-label');
        const timelineSlider = document.getElementById('timeline-slider');
        const chanceValor = document.getElementById('chance-valor');
        const tempoDecorridoValor = document.getElementById('tempo-decorrido-valor');
        const faqButton = document.getElementById('faq-button');
        const faqInput = document.getElementById('faq-input');
        const faqResult = document.getElementById('faq-result');
        const reportForm = document.getElementById('report-form');
        const reportResult = document.getElementById('report-result');
        const startAssistantButton = document.getElementById('start-assistant-button');
        const generateGuideButton = document.getElementById('generate-guide-button');
        const assistantPlaceholder = document.getElementById('assistant-placeholder');
        const guidePlaceholder = document.getElementById('guide-placeholder');

        // --- Funções da API ---

        // Função fetch robusta com retentativa e tratamento de erro
        async function fetchWithExponentialBackoff(url, options, retries = 3, delay = 1000) {
            try {
                const response = await fetch(url, options);
                const data = await response.json(); // Tenta parsear JSON mesmo em caso de erro

                if (!response.ok) {
                    // Extrai a mensagem de erro da API, se disponível
                    const errorMessage = data?.error?.message || `Erro HTTP: ${response.status}`;
                    console.error("Erro da API:", data);
                    
                    // Lógica de retentativa para throttling (código 429)
                    if (response.status === 429 && retries > 0) {
                        console.warn(`API sobrecarregada. Tentando novamente em ${delay}ms...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);
                    }
                    throw new Error(errorMessage);
                }
                return data; // Retorna os dados em caso de sucesso
            } catch (error) {
                console.error("Erro de rede ou parse:", error);
                 if (retries > 0 && !(error instanceof SyntaxError)) { // Não tenta novamente em erro de JSON
                    console.warn(`Falha na requisição. Tentando novamente em ${delay}ms...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithExponentialBackoff(url, options, retries - 1, delay * 2);
                } else {
                    throw error; // Lança o erro final
                }
            }
        }

        const checkApiKey = (targetElement) => {
            if (!GEMINI_API_KEY || GEMINI_API_KEY === "") {
                targetElement.innerHTML = `<p class="text-red-600 font-semibold">Erro: Chave de API do Gemini não configurada.</p>`;
                return false;
            }
            return true;
        };
        
        const parseApiResponse = (candidate) => {
            if (!candidate || !candidate.content?.parts?.[0]?.text) {
                throw new Error("A API retornou uma resposta vazia ou em formato inesperado.");
            }
            let responseText = candidate.content.parts[0].text;
            // Remove marcações de código que a API pode adicionar
            responseText = responseText.replace(/```json/g, '').replace(/```/g, '').trim();
            try {
                return JSON.parse(responseText);
            } catch (e) {
                console.error("Falha ao parsear JSON:", responseText);
                throw new Error("A API não retornou um JSON válido.");
            }
        };
        
        const parseTextApiResponse = (candidate) => {
             if (!candidate || !candidate.content?.parts?.[0]?.text) {
                throw new Error("A API retornou uma resposta de texto vazia.");
            }
            return candidate.content.parts[0].text;
        };

        const analisarRisco = async () => {
            if (!checkApiKey(analysisResult)) return;

            const userText = messageInput.value.trim();
            if (!userText) {
                analysisResult.innerHTML = `<p class="text-yellow-600 font-semibold">Por favor, insira uma mensagem para ser analisada.</p>`;
                return;
            }

            analysisResult.innerHTML = `<div class="flex flex-col items-center justify-center"><div class="spinner"></div><p class="mt-2 text-gray-600">Analisando com a IA...</p></div>`;
            analyzeButton.disabled = true;

            const systemPrompt = `Você é um especialista em segurança digital e detecção de fraudes. Analise o texto do usuário. Responda APENAS com um objeto JSON com a estrutura: {"classificacao": "Seguro" | "Suspeito" | "Possível Golpe", "justificativa": "Explicação concisa.", "recomendacao": "Ação clara para o usuário."}`;
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;

            const payload = {
                contents: [{ parts: [{ text: userText }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                const result = await fetchWithExponentialBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const parsedJson = parseApiResponse(result.candidates?.[0]);
                displayResult(parsedJson, analysisResult);
            } catch (error) {
                console.error('Erro ao analisar risco:', error);
                analysisResult.innerHTML = `<p class="text-red-600 font-semibold">Ocorreu um erro: ${error.message}</p>`;
            } finally {
                analyzeButton.disabled = false;
            }
        };

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
        });

        const handleFileSelect = async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            if (!checkApiKey(visualAnalysisResult)) return;

            const reader = new FileReader();
            reader.onload = (e) => { imagePreview.src = e.target.result; imagePreviewContainer.classList.remove('hidden'); };
            reader.readAsDataURL(file);

            visualAnalysisResult.innerHTML = `<div class="flex flex-col items-center justify-center"><div class="spinner"></div><p class="mt-2 text-gray-600">Analisando imagem com a IA...</p></div>`;
            fileUploadLabel.classList.add('cursor-not-allowed', 'bg-gray-400');
            fileUploadInput.disabled = true;

            try {
                const base64Data = await toBase64(file);
                await analisarImagem(base64Data, file.type);
            } catch (error) {
                console.error('Erro ao processar arquivo:', error);
                visualAnalysisResult.innerHTML = `<p class="text-red-600 font-semibold">Erro ao ler a imagem. Tente novamente.</p>`;
            } finally {
                fileUploadLabel.classList.remove('cursor-not-allowed', 'bg-gray-400');
                fileUploadInput.disabled = false;
                event.target.value = '';
            }
        };

        const analisarImagem = async (base64ImageData, mimeType) => {
            const systemPrompt = `Você é um especialista em segurança digital. Analise a imagem em busca de sinais de fraude (erros de português, design amador, URLs, dados inconsistentes). Responda APENAS com um objeto JSON com a estrutura: {"classificacao": "Seguro" | "Suspeito" | "Possível Golpe", "justificativa": "Explicação concisa.", "recomendacao": "Ação clara para o usuário."}`;
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
            const payload = {
                contents: [{ parts: [{ text: "Analise esta imagem em busca de sinais de fraude." }, { inlineData: { mimeType: mimeType, data: base64ImageData } }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                const result = await fetchWithExponentialBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const parsedJson = parseApiResponse(result.candidates?.[0]);
                displayResult(parsedJson, visualAnalysisResult);
            } catch (error) {
                console.error('Erro ao analisar imagem:', error);
                visualAnalysisResult.innerHTML = `<p class="text-red-600 font-semibold">Ocorreu um erro: ${error.message}</p>`;
            }
        };

        const displayResult = (data, targetElement) => {
            let bgColor, textColor, title;
            switch (data.classificacao) {
                case 'Possível Golpe': bgColor = 'bg-red-100'; textColor = 'text-red-800'; title = '❌ Possível Golpe'; break;
                case 'Suspeito': bgColor = 'bg-yellow-100'; textColor = 'text-yellow-800'; title = '⚠️ Suspeito'; break;
                default: bgColor = 'bg-green-100'; textColor = 'text-green-800'; title = '✅ Seguro'; break;
            }
            targetElement.innerHTML = `<div class="${bgColor} ${textColor} p-4 rounded-lg"><h3 class="font-bold text-lg mb-2">${title}</h3><p class="font-semibold">Justificativa:</p><p class="mb-2">${data.justificativa}</p><p class="font-semibold">Recomendação:</p><p>${data.recomendacao}</p></div>`;
        };

        const askFaq = async () => {
            if (!checkApiKey(faqResult)) return;

            const userQuestion = faqInput.value.trim();
            if (!userQuestion) {
                faqResult.innerHTML = `<p class="text-yellow-600 font-semibold">Por favor, digite sua dúvida.</p>`;
                return;
            }

            faqResult.innerHTML = `<div class="flex flex-col items-center justify-center"><div class="spinner"></div><p class="mt-2 text-gray-600">Buscando resposta...</p></div>`;
            faqButton.disabled = true;

            const systemPrompt = `Você é um assistente virtual especialista em segurança digital e prevenção de golpes no Brasil. Responda às perguntas do usuário de forma clara, direta e útil, com conselhos práticos.`;
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
            const payload = { contents: [{ parts: [{ text: userQuestion }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };

            try {
                const result = await fetchWithExponentialBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                const answer = parseTextApiResponse(result.candidates?.[0]);
                faqResult.innerHTML = `<div class="bg-blue-50 p-4 rounded-lg text-blue-800">${answer.replace(/\n/g, '<br>')}</div>`;
            } catch (error) {
                console.error('Erro no FAQ:', error);
                faqResult.innerHTML = `<p class="text-red-600 font-semibold">Ocorreu um erro: ${error.message}</p>`;
            } finally {
                faqButton.disabled = false;
            }
        };
        
        // --- Funções de UI ---

        const updateRecoveryChance = (e) => {
            const hours = parseInt(e.target.value);
            
            // Atualiza o texto do tempo
            let tempoTexto;
            if (hours === 1) {
                tempoTexto = "1 hora";
            } else if (hours < 24) {
                tempoTexto = `${hours} horas`;
            } else if (hours === 24) {
                tempoTexto = "1 dia";
            } else if (hours < 48) {
                tempoTexto = `1 dia e ${hours - 24} horas`;
            } else { // hours === 48
                tempoTexto = "2 dias";
            }
            tempoDecorridoValor.textContent = tempoTexto;

            // Atualiza a porcentagem da chance
            const baseChance = 80;
            const decayRate = 1.6;
            const chance = Math.max(5, baseChance - (hours - 1) * decayRate);
            chanceValor.textContent = `${Math.round(chance)}%`;
        };
        
        const handleReportSubmit = (event) => {
            event.preventDefault();
            reportResult.innerHTML = `<p class="text-green-600 font-semibold text-center">Obrigado! Seu relato foi enviado e ajudará a comunidade.</p>`;
            reportForm.reset();
            setTimeout(() => { reportResult.innerHTML = ''; }, 5000);
        };
        
        const showPlaceholderMessage = (element, message) => {
            element.innerHTML = `<p class="text-indigo-600 font-semibold">${message}</p>`;
             setTimeout(() => { element.innerHTML = ''; }, 4000);
        };

        // --- Adicionando Event Listeners ---
        analyzeButton.addEventListener('click', analisarRisco);
        fileUploadInput.addEventListener('change', handleFileSelect);
        timelineSlider.addEventListener('input', updateRecoveryChance);
        faqButton.addEventListener('click', askFaq);
        reportForm.addEventListener('submit', handleReportSubmit);
        startAssistantButton.addEventListener('click', () => showPlaceholderMessage(assistantPlaceholder, 'Funcionalidade em desenvolvimento.'));
        generateGuideButton.addEventListener('click', () => showPlaceholderMessage(guidePlaceholder, 'Funcualidade em desenvolvimento.'));

    </script>
</body>
</html>
